//================================================================================================//
//                                                                                                //
// PROJET       : DBM620                                                                          //
// MODULE       : Board                                                                           //
// DESCRIPTION  :                                                                                 //
// CREATION     : 18/12/2017                                                                      //
// HISTORIQUE   :                                                                                 //
//                                                                                                //
//================================================================================================//

#ifndef _BMS_H_
#define _BMS_H_

//================================================================================================//
//                                        FICHIERS INCLUS                                         //
//================================================================================================//
#include "../typedefs.h"
#include "../Low-Level/board.h"
#include "./PacketRequestGenerator.h"
#include "./PacketReceiveProcessor.h"

//================================================================================================//
//                                            DEFINES                                             //
//================================================================================================//

//================================================================================================//
//                                          ENUMERATIONS                                          //
//================================================================================================//
typedef enum {
    READ_VOLTAGE_AND_STATUS = 0,
    SEND_TIMING_REQUEST,
    SEND_SETTINGS_REQUEST,
    SEND_BALANCE_CURRENT_COUNT_REQUEST,
    SEND_PACKET_RECEIVED_REQUEST,
    SEND_IDENTIFY_REQUEST,
    SEND_BAD_PACKET_COUNTER
}e_STATE_BMS;

extern CellModuleInfo cmi[maximum_controller_cell_modules];
//================================================================================================//
//                                      STRUCTURES ET UNIONS                                      //
//================================================================================================//

//================================================================================================//
//                                VARIABLES ET FONCTION PARTAGEES                                 //
//================================================================================================//

//------------------------------------------------------------------------------------------------//
//---                                        Variables                                         ---//
//------------------------------------------------------------------------------------------------//

//------------------------------------------------------------------------------------------------//
//---                                        Fonctions                                         ---//
//------------------------------------------------------------------------------------------------//
void BMS_TaskInit(void);
void BMS_TaskRun(void);

uint8_t BMS_GetNbCells(void);
CellModuleInfo* BMS_GetCMI(uint16_t idx);
PacketRequestGenerator * BMS_GetPrg(void);
PacketReceiveProcessor * BMS_GetReceiveProc(void);
void BMS_SendIdentify(uint8_t cmiIdx);

#endif //--- _BOARD_
